<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Warehouse Forklift Driving Game</title>
<link rel="manifest" href="manifest.json">
<style>
body{
  margin:0;
  background:#0f172a;
  font-family:sans-serif;
  color:#f8fafc;
  text-align:center;
}
.row{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
  padding:10px;
}
button{
  background:#1e293b;
  color:white;
  border:none;
  padding:8px 14px;
  border-radius:8px;
  font-size:16px;
}
#game{
  position:relative;width:100%;margin:8px auto;
  background:
    radial-gradient(1200px 600px at 30% -20%, #13213a 0%, #0f1a2a 45%, #0b1220 100%),
    repeating-linear-gradient(0deg, rgba(255,255,255,.04) 0 2px, transparent 2px 22px),
    repeating-linear-gradient(90deg, rgba(255,255,255,.03) 0 2px, transparent 2px 22px);
  background-position:
    center center,
    calc(var(--bgx,0px)) calc(var(--bgy,0px)),
    calc(var(--bgx,0px)/2) calc(var(--bgy,0px)/2);
  border:2px solid #6b7280;border-radius:12px;overflow:hidden;touch-action:none;
  max-height: calc(100dvh - 220px);
}
.controls{
  display:flex;
  justify-content:center;
  flex-wrap:wrap;
  gap:10px;
  padding:10px;
}
.controls button{
  width:60px;height:60px;font-size:22px;
}
</style>
</head>
<body>
<div class="row">
  <div><strong>Delivered:</strong> <span id="delivered">0</span>/8</div>
  <div>Score: <span id="score">0</span></div>
  <div>Time: <span id="timer">00:00.0</span></div>
  <button id="reset">Reset</button>
  <button id="share">Share</button>
</div>
<div id="game">
  <canvas id="stage" width="800" height="600"></canvas>
</div>
<div class="controls">
  <button id="left">⬅️</button>
  <button id="up">⬆️</button>
  <button id="right">➡️</button>
  <button id="down">⬇️</button>
</div>
<script>
const game = document.getElementById('game');
const stage = document.getElementById('stage');
const ctx = stage.getContext('2d');

const BASE_W = 800, BASE_H = 600;

let keys = {};
let score = 0, delivered = 0, time = 0;
let timerInterval;

let lift = { x:100, y:100, angle:0, carrying:null };
let pallets = [];
const SPEED = 2.5;

let bgx = 0, bgy = 0;
const BG_SPEED = 0.6;
const BG_IDLE  = 0.08;

function spawnPallets(){
  pallets = [];
  const colors = ['#f87171','#4ade80','#60a5fa','#facc15'];
  for(let i=0;i<8;i++){
    pallets.push({
      x: Math.random()*(BASE_W-40)+20,
      y: Math.random()*(BASE_H-40)+20,
      color: colors[Math.floor(Math.random()*colors.length)],
      size: 20+Math.random()*20
    });
  }
}

function resetGame(){
  score=0; delivered=0; time=0;
  lift = { x:100, y:100, angle:0, carrying:null };
  spawnPallets();
  document.getElementById('score').textContent=score;
  document.getElementById('delivered').textContent=delivered;
  document.getElementById('timer').textContent="00:00.0";
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    time+=0.1;
    const m = String(Math.floor(time/60)).padStart(2,'0');
    const s = String(Math.floor(time%60)).padStart(2,'0');
    const ms = Math.floor((time*10)%10);
    document.getElementById('timer').textContent=`${m}:${s}.${ms}`;
  },100);
}
document.getElementById('reset').onclick=resetGame;
document.getElementById('share').onclick=()=>{
  if(navigator.share){
    navigator.share({
      title:"Warehouse Forklift Driving Game",
      text:`I delivered ${delivered}/8 pallets in ${document.getElementById('timer').textContent}!`,
      url:location.href
    });
  } else {
    alert("Sharing not supported on this device.");
  }
}

function fit() {
  const header   = document.querySelector('.row');
  const controls = document.querySelector('.controls');

  const vw  = Math.min(window.innerWidth,  document.documentElement.clientWidth);
  const dvh = Math.min(window.innerHeight, document.documentElement.clientHeight);

  const headerH   = header   ? header.getBoundingClientRect().height   : 0;
  const controlsH = (controls && getComputedStyle(controls).display !== 'none')
                     ? controls.getBoundingClientRect().height : 0;
  const gutters   = 24;

  const availableH = Math.max(240, dvh - headerH - controlsH - gutters);
  const scale = Math.min(vw / BASE_W, availableH / BASE_H, 1);

  const tx = (vw  - BASE_W * scale) / 2;
  const ty = (availableH - BASE_H * scale) / 2;

  stage.style.transform = `translate(${tx}px, ${Math.max(0, ty)}px) scale(${scale})`;
  game.style.height = availableH + 'px';
  game.style.maxHeight = availableH + 'px';
}
addEventListener('resize', fit);
addEventListener('orientationchange', fit);
new ResizeObserver(fit).observe(game);

function tick(){
  if(keys.left) lift.angle -= 0.05;
  if(keys.right) lift.angle += 0.05;
  if(keys.up || keys.down){
    const dir = keys.up ? 1 : -1;
    lift.x += Math.cos(lift.angle) * SPEED * dir;
    lift.y += Math.sin(lift.angle) * SPEED * dir;

    bgx -= dir * Math.cos(lift.angle) * SPEED * BG_SPEED;
    bgy -= dir * Math.sin(lift.angle) * SPEED * BG_SPEED;
  } else {
    bgx -= BG_IDLE;
    bgy -= BG_IDLE;
  }
  game.style.setProperty('--bgx', bgx + 'px');
  game.style.setProperty('--bgy', bgy + 'px');

  lift.x = Math.max(0, Math.min(BASE_W, lift.x));
  lift.y = Math.max(0, Math.min(BASE_H, lift.y));

  pallets.forEach((p,i)=>{
    const dx = lift.x - p.x;
    const dy = lift.y - p.y;
    if(Math.hypot(dx,dy) < 20 && !lift.carrying){
      lift.carrying = p;
      pallets.splice(i,1);
    }
  });

  if(lift.carrying && lift.x>750 && lift.y>250 && lift.y<350){
    score += 10;
    delivered++;
    lift.carrying=null;
    document.getElementById('score').textContent=score;
    document.getElementById('delivered').textContent=delivered;
    if(delivered>=8){
      clearInterval(timerInterval);
      alert("All pallets delivered!");
    }
  }
}

function render(){
  ctx.clearRect(0,0,BASE_W,BASE_H);
  ctx.fillStyle="rgba(0,255,0,0.1)";
  ctx.fillRect(750,250,50,100);
  ctx.strokeStyle="#22c55e";
  ctx.strokeRect(750,250,50,100);
  ctx.fillStyle="#22c55e";
  ctx.font="16px sans-serif";
  ctx.fillText("DOCK", 755, 300);

  pallets.forEach(p=>{
    ctx.fillStyle=p.color;
    ctx.fillRect(p.x-10, p.y-10, p.size, p.size);
  });

  if(lift.carrying){
    ctx.fillStyle=lift.carrying.color;
    ctx.fillRect(lift.x-10, lift.y-30, lift.carrying.size, lift.carrying.size);
  }

  ctx.save();
  ctx.translate(lift.x, lift.y);
  ctx.rotate(lift.angle);
  ctx.fillStyle="yellow";
  ctx.fillRect(-15,-10,30,20);
  ctx.fillStyle="gray";
  ctx.fillRect(10,-2,10,4);
  ctx.restore();
}

function loop(){
  tick();
  render();
  requestAnimationFrame(loop);
}

document.addEventListener('keydown',e=>{ keys[e.key.toLowerCase()] = true; });
document.addEventListener('keyup',e=>{ keys[e.key.toLowerCase()] = false; });
document.getElementById('left').ontouchstart=()=>keys.left=true;
document.getElementById('left').ontouchend=()=>keys.left=false;
document.getElementById('up').ontouchstart=()=>keys.up=true;
document.getElementById('up').ontouchend=()=>keys.up=false;
document.getElementById('right').ontouchstart=()=>keys.right=true;
document.getElementById('right').ontouchend=()=>keys.right=false;
document.getElementById('down').ontouchstart=()=>keys.down=true;
document.getElementById('down').ontouchend=()=>keys.down=false;

resetGame();
fit();
loop();
</script>
</body>
</html>