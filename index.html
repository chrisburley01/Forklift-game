<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Forklift Game</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f172a" />

  <style>
    :root { --bg:#0f172a; --panel:#111827; --line:#1f2937; --text:#e5e7eb; }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 20px rgba(0,0,0,.2)}
    h1{margin:0 0 8px;line-height:1.05}
    #game{position:relative;width:100%;margin:8px auto;background:#0f1a2a;border:2px solid #6b7280;border-radius:12px;overflow:hidden;touch-action:none}
    #stage{position:relative;width:800px;height:500px;transform-origin:top left}

    /* Walls */
    .wall{position:absolute;background:#0b1220}

    /* Forklift */
    .forklift{position:absolute;width:46px;height:26px;transform-origin:center}
    .lift-body{
      position:absolute; left:6px; top:6px; width:34px; height:14px;
      background:linear-gradient(180deg,#ffd84a,#facc15);
      border-radius:4px; box-shadow:0 2px 8px rgba(0,0,0,.45) inset;
      border:1px solid #b08900;
    }
    .lift-cab{
      position:absolute; left:8px; top:2px; width:11px; height:10px;
      background:linear-gradient(180deg,#2f3640,#111827); border-radius:2px;
      border:1px solid #0b0f1a;
    }
    .lift-mast{
      position:absolute; right:2px; top:2px; width:4px; height:18px;
      background:linear-gradient(180deg,#3b3f46,#1f2937); border-radius:2px;
      border:1px solid #161b22;
    }
    .lift-forks{
      position:absolute; right:-10px; top:16px; width:20px; height:4px;
      background:linear-gradient(180deg,#c8a95a,#9a7a2c); border-radius:2px;
      box-shadow:0 0 0 1px #6b5b2a inset;
    }
    .lift-wheel{
      position:absolute; width:8px; height:8px; border-radius:50%;
      background:radial-gradient(circle at 30% 30%, #6b7280, #111827);
      border:1px solid #090d14;
      bottom:-3px; box-shadow:0 1px 1px rgba(0,0,0,.6);
    }
    .lift-wheel.front{ left:10px }
    .lift-wheel.rear{ left:28px }

    /* Pallets */
    .pallet{
      position:absolute; width:30px; height:30px;
      background:repeating-linear-gradient(0deg, #b87333 0 6px, #a05e22 6px 12px);
      border:2px solid #8b4a0e; border-radius:4px; box-shadow:0 2px 6px rgba(0,0,0,.35);
    }
    .pallet::before{ content:""; position:absolute; inset:4px 6px;
      background:linear-gradient(90deg,#2f2f2f,#1f1f1f); opacity:.6; border-radius:1px; }
    .pallet::after{ content:""; position:absolute; inset:2px; box-shadow:0 0 8px rgba(255,140,0,.25); border-radius:3px; }

    .row{display:flex;gap:8px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid #374151;background:#1f2937;color:var(--text);cursor:pointer}
    .hud{display:flex;gap:12px;align-items:center;flex-wrap:wrap}

    /* Touch controls */
    .controls{display:none;margin-top:12px;gap:8px;justify-content:center}
    .pad{width:70px;height:70px;border-radius:12px;border:1px solid #374151;background:#1f2937;display:flex;align-items:center;justify-content:center;font-weight:700;user-select:none}
    @media (max-width: 820px){ .controls{display:flex} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="row">
        <h1>Warehouse Forklift Driving Game</h1>
        <div class="hud">
          <div><strong>Score:</strong> <span id="score">0</span>/<span id="total">0</span></div>
          <button id="reset" class="btn">Reset</button>
        </div>
      </div>
      <p style="margin:8px 0 12px">Keyboard: Arrow keys. On phone: use the pads below.</p>

      <div id="game" aria-label="Forklift game area">
        <div id="stage"></div>
      </div>

      <div class="controls">
        <div class="pad" data-pad="left">⟵</div>
        <div style="display:flex;flex-direction:column;gap:8px">
          <div class="pad" data-pad="up">⟰</div>
          <div class="pad" data-pad="down">⟱</div>
        </div>
        <div class="pad" data-pad="right">⟶</div>
      </div>
    </div>
  </div>

  <script>
    // World constants (logical px)
    const BASE_W=800, BASE_H=500, LIFT_W=46, LIFT_H=26, SPEED=4, TURN=4, PALLET_RADIUS=30;

    const game  = document.getElementById('game');
    const stage = document.getElementById('stage');
    const scoreEl = document.getElementById('score');
    const totalEl = document.getElementById('total');