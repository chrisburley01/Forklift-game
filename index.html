<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Forklift Game</title>

  <!-- PWA hooks -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f172a" />

  <style>
    :root { --bg:#0f172a; --panel:#111827; --line:#1f2937; --text:#e5e7eb; }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 20px rgba(0,0,0,.2)}
    h1{margin:0 0 8px}
    #game{position:relative;width:100%;max-width:800px;height:500px;margin:8px auto;background:#374151;border:2px solid #6b7280;border-radius:12px;overflow:hidden;touch-action:none}
    .wall{position:absolute;background:#0b1220}
    .forklift{position:absolute;width:40px;height:20px;background:#facc15;border-radius:4px;box-shadow:0 2px 8px rgba(0,0,0,.4);transform-origin:center}
    .pallet{position:absolute;width:30px;height:30px;background:#92400e;border:2px solid #b45309;border-radius:4px;box-shadow:0 2px 6px rgba(0,0,0,.3)}
    .row{display:flex;gap:8px;align-items:center;justify-content:space-between}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid #374151;background:#1f2937;color:var(--text);cursor:pointer}
    .hud{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    /* Mobile touch controls */
    .controls{display:none;margin-top:12px;gap:8px;justify-content:center}
    .pad{width:70px;height:70px;border-radius:12px;border:1px solid #374151;background:#1f2937;display:flex;align-items:center;justify-content:center;font-weight:700;user-select:none}
    @media (max-width: 820px){ .controls{display:flex} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="row">
        <h1>Warehouse Forklift Driving Game</h1>
        <div class="hud">
          <div><strong>Score:</strong> <span id="score">0</span>/<span id="total">0</span></div>
          <button id="reset" class="btn">Reset</button>
        </div>
      </div>
      <p style="margin:8px 0 12px">Keyboard: Arrow keys. On phone: use the pads below.</p>
      <div id="game" aria-label="Forklift game area"></div>
      <div class="controls">
        <div class="pad" data-pad="left">⟵</div>
        <div style="display:flex;flex-direction:column;gap:8px">
          <div class="pad" data-pad="up">⟰</div>
          <div class="pad" data-pad="down">⟱</div>
        </div>
        <div class="pad" data-pad="right">⟶</div>
      </div>
    </div>
  </div>

  <script>
    // --- Game state ---
    const W = 800, H = 500;
    const size = { w: 40, h: 20 };
    const speed = 4, turnSpeed = 4;
    const game = document.getElementById('game');
    game.style.width = W + 'px'; game.style.height = H + 'px';

    let forklift = { x: 80, y: 80, angle: 0 };
    let pallets = [
      { id:1, x:200, y:150, collected:false },
      { id:2, x:350, y:300, collected:false },
      { id:3, x:520, y:220, collected:false },
      { id:4, x:700, y:120, collected:false },
      { id:5, x:140, y:380, collected:false },
    ];
    const keys = { left:false, right:false, up:false, down:false };
    const scoreEl = document.getElementById('score');
    const totalEl = document.getElementById('total');
    totalEl.textContent = pallets.length;

    // --- Build scene ---
    // Walls
    const walls = [
      {left:0, top:0, width:'100%', height:'10px'},
      {left:0, bottom:0, width:'100%', height:'10px'},
      {top:0, left:0, width:'10px', height:'100%'},
      {top:0, right:0, width:'10px', height:'100%'}
    ];
    walls.forEach(s=>{
      const w = document.createElement('div'); w.className='wall';
      Object.assign(w.style, s);
      game.appendChild(w);
    });

    // Forklift element
    const liftEl = document.createElement('div');
    liftEl.className = 'forklift';
    game.appendChild(liftEl);

    // Pallets
    const palletEls = new Map();
    function renderPallets(){
      pallets.forEach(p=>{
        let el = palletEls.get(p.id);
        if(p.collected){
          if(el){ el.remove(); palletEls.delete(p.id); }
          return;
        }
        if(!el){
          el = document.createElement('div');
          el.className='pallet';
          palletEls.set(p.id, el);
          game.appendChild(el);
        }
        el.style.left = p.x + 'px';
        el.style.top  = p.y + 'px';
      });
      scoreEl.textContent = pallets.filter(p=>p.collected).length;
    }

    function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

    // --- Input (keyboard) ---
    window.addEventListener('keydown', e=>{
      if(e.key==='ArrowLeft')  keys.left = true;
      if(e.key==='ArrowRight') keys.right = true;
      if(e.key==='ArrowUp')    keys.up = true;
      if(e.key==='ArrowDown')  keys.down = true;
    });
    window.addEventListener('keyup', e=>{
      if(e.key==='ArrowLeft')  keys.left = false;
      if(e.key==='ArrowRight') keys.right = false;
      if(e.key==='ArrowUp')    keys.up = false;
      if(e.key==='ArrowDown')  keys.down = false;
    });

    // --- Input (touch pads) ---
    const activePads = new Set();
    function padSet(dir, on){ if(on) activePads.add(dir); else activePads.delete(dir); syncPads(); }
    function syncPads(){
      keys.left  = activePads.has('left');
      keys.right = activePads.has('right');
      keys.up    = activePads.has('up');
      keys.down  = activePads.has('down');
    }
    function wirePad(el, dir){
      const start = (e)=>{ e.preventDefault(); padSet(dir,true); };
      const end   = (e)=>{ e.preventDefault(); padSet(dir,false); };
      el.addEventListener('pointerdown', start);
      el.addEventListener('pointerup', end);
      el.addEventListener('pointercancel', end);
      el.addEventListener('pointerleave', end);
    }
    document.querySelectorAll('[data-pad]').forEach(el=>wirePad(el, el.dataset.pad));

    // --- Game loop ---
    function tick(){
      if(keys.left)  forklift.angle -= turnSpeed;
      if(keys.right) forklift.angle += turnSpeed;
      const rad = forklift.angle * Math.PI / 180;
      if(keys.up){   forklift.x += speed * Math.cos(rad); forklift.y += speed * Math.sin(rad); }
      if(keys.down){ forklift.x -= speed * Math.cos(rad); forklift.y -= speed * Math.sin(rad); }
      forklift.x = clamp(forklift.x, 10, W - size.w - 10);
      forklift.y = clamp(forklift.y, 10, H - size.h - 10);

      // Collect pallets
      for(const p of pallets){
        if(!p.collected){
          const dx = p.x - forklift.x, dy = p.y - forklift.y;
          if(Math.hypot(dx,dy) < 30){ p.collected = true; }
        }
      }

      // Render forklift
      liftEl.style.left = forklift.x + 'px';
      liftEl.style.top  = forklift.y + 'px';
      liftEl.style.transform = `rotate(${forklift.angle}deg)`;
      renderPallets();

      requestAnimationFrame(tick);
    }
    renderPallets();
    requestAnimationFrame(tick);

    // Reset
    document.getElementById('reset').onclick = ()=>{
      forklift = { x:80, y:80, angle:0 };
      pallets.forEach(p=>p.collected=false);
      renderPallets();
    };

    // --- PWA: register service worker (requires sw.js in repo root) ---
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js', { scope: './' }).catch(()=>{});
      });
    }
  </script>
</body>
</html>