<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>Warehouse Forklift Driving Game</title>

<!-- PWA hooks -->
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#0f172a" />
<link rel="apple-touch-icon" href="icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Forklift">

<style>
  :root { --bg:#0f172a; --panel:#111827; --line:#1f2937; --text:#e5e7eb; --dvh: 100dvh; }
  *{box-sizing:border-box}
  html,body{
    height:100%; margin:0; background:var(--bg); color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    padding:
      env(safe-area-inset-top)
      env(safe-area-inset-right)
      env(safe-area-inset-bottom)
      env(safe-area-inset-left);
    overflow-x:hidden;
  }
  .wrap{max-width:980px;margin:0 auto;padding:16px}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px;
    box-shadow:0 20px 40px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.03)}
  h1{margin:0 0 8px;line-height:1.05}

  /* Rolling warehouse floor with parallax; bgx/bgy set from JS */
  #game{
    --bgx: 0px; --bgy: 0px;
    position:relative;width:100%;margin:8px auto;
    background:
      radial-gradient(1200px 600px at 30% -20%, #13213a 0%, #0f1a2a 45%, #0b1220 100%),
      repeating-linear-gradient(0deg,  rgba(255,255,255,.04) 0 2px, transparent 2px 22px),
      repeating-linear-gradient(90deg, rgba(255,255,255,.03) 0 2px, transparent 2px 22px);
    background-position:
      center center,
      calc(var(--bgx)) calc(var(--bgy)),
      calc(var(--bgx) / 2) calc(var(--bgy) / 2);
    background-size:
      auto,
      24px 24px,
      48px 48px;
    will-change: background-position;
    border:2px solid #6b7280;border-radius:12px;overflow:hidden;touch-action:none;
    max-height: calc(var(--dvh) - 220px); /* ALWAYS fits on phones */
  }
  #stage{position:relative;width:800px;height:500px;transform-origin:top left;filter:drop-shadow(0 10px 18px rgba(0,0,0,.35))}

  /* Walls */
  .wall{position:absolute;background:#0b1220}

  /* Racking */
  .rack { position:absolute; pointer-events:none; }
  .rack .upright{
    position:absolute; width:8px; height:100%;
    background:linear-gradient(180deg,#335a7a,#1e3a55);
    border:1px solid #122638; border-radius:2px;
    box-shadow:0 1px 0 rgba(255,255,255,.05) inset, 0 6px 10px rgba(0,0,0,.25);
  }
  .rack .beam{
    position:absolute; height:6px;
    background:linear-gradient(180deg,#f97316,#ea580c);
    border:1px solid #9a3f07; border-radius:2px;
    box-shadow:0 1px 0 rgba(255,255,255,.08) inset, 0 3px 6px rgba(0,0,0,.3);
  }
  .rack.top  { top:16px;  left:20px; right:140px; height:80px; }
  .rack.bot  { bottom:16px; left:20px; right:140px; height:80px; }

  /* Dock */
  .dock{
    position:absolute; top:50px; right:20px; width:100px; height:400px;
    background:rgba(34,197,94,.15); border:2px dashed #22c55e; border-radius:8px;
    display:flex; align-items:center; justify-content:center; color:#86efac; font-weight:700;
    text-shadow:0 1px 2px rgba(0,0,0,.5); animation:dockPulse 2.4s ease-in-out infinite;
  }
  @keyframes dockPulse { 0%,100%{box-shadow:0 0 0 0 rgba(34,197,94,.35)} 50%{box-shadow:0 0 20px 8px rgba(34,197,94,.25)} }

  /* Forklift (high-detail SVG wrapper) */
  .forklift{
    position:absolute; width:56px; height:36px; transform-origin:center;
    filter: drop-shadow(0 3px 6px rgba(0,0,0,.35));
  }
  .forklift svg{ width:56px; height:36px; display:block }

  /* Pallets */
  .pallet{
    position:absolute; border-radius:6px; border:1px solid rgba(0,0,0,.28);
    box-shadow:0 1px 0 rgba(255,255,255,.08) inset, 0 6px 10px rgba(0,0,0,.28);
    overflow:hidden;
  }
  .pallet.small{  background:repeating-linear-gradient(0deg,#9bbd7b 0 7px,#84aa62 7px 14px); }
  .pallet.medium{ background:repeating-linear-gradient(0deg,#c98954 0 7px,#a96e3e 7px 14px); }
  .pallet.large{  background:repeating-linear-gradient(0deg,#78a9bd 0 7px,#5e93a8 7px 14px); }
  .pallet.timed{  background:repeating-linear-gradient(0deg,#de8467 0 7px,#c66646 7px 14px); }
  .pallet::before{
    content:""; position:absolute; inset:0;
    background:linear-gradient(90deg, rgba(0,0,0,.18), rgba(255,255,255,.06) 10%, rgba(0,0,0,.12) 90%);
    mix-blend-mode:multiply; opacity:.55; pointer-events:none;
  }
  .pallet::after{
    content:""; position:absolute; left:6%; right:6%; bottom:-10%;
    height:28%; border-radius:8px;
    background: radial-gradient(50% 100% at 50% 0%, rgba(0,0,0,.25), transparent 70%);
    pointer-events:none;
  }
  .pallet .strap{ position:absolute; left:12%; right:12%; top:42%; height:12%;
    background:linear-gradient(90deg,#2b2b2b,#1a1a1a); opacity:.7; border-radius:2px; }
  .pallet .label{ position:absolute; right:6px; bottom:6px; width:12px; height:8px;
    background:#e8ecf3; border:1px solid rgba(0,0,0,.25); border-radius:2px; }

  .row{display:flex;gap:8px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid #374151;background:#1f2937;color:var(--text);cursor:pointer}
  .hud{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .hud-right{margin-left:auto;display:flex;gap:8px;align-items:center}

  /* Touch controls */
  .controls{display:none;margin-top:12px;gap:8px;justify-content:center}
  .pad{width:70px;height:70px;border-radius:12px;border:1px solid #374151;background:#1f2937;display:flex;align-items:center;justify-content:center;font-weight:700;user-select:none;font-size:20px}
  @media (max-width: 820px){ .controls{display:flex} }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="row">
      <h1>Warehouse Forklift Driving Game</h1>
      <div class="hud">
        <div><strong>Delivered:</strong> <span id="delivered">0</span>/<span id="target">8</span></div>
        <div>Score: <span id="score">0</span></div>
        <div>Time: <span id="timer">00:00.0</span></div>
        <button id="reset" class="btn">Reset</button>
      </div>
      <div class="hud-right">
        <button id="install" class="btn" style="display:none">Install</button>
        <button id="share" class="btn">Share</button>
      </div>
    </div>

    <div id="game"><div id="stage"></div></div>

    <div class="controls">
      <div class="pad" data-pad="left">‚üµ</div>
      <div style="display:flex;flex-direction:column;gap:8px">
        <div class="pad" data-pad="up">‚ü∞</div>
        <div class="pad" data-pad="down">‚ü±</div>
      </div>
      <div class="pad" data-pad="right">‚ü∂</div>
    </div>
  </div>
</div>

<script>
  const BASE_W=800, BASE_H=500, LIFT_W=56, LIFT_H=36;
  const SPEED=4, TURN=4, PICK_RADIUS=30, TARGET=8;

  // üöÄ Boosted so rolling background is obvious
  let bgx = 0, bgy = 0;
  const BG_SPEED = 1.2;
  const BG_IDLE  = 0.20;

  const game = document.getElementById('game');
  const stage= document.getElementById('stage');
  const scoreEl=document.getElementById('score');
  const timerEl=document.getElementById('timer');
  const deliveredEl=document.getElementById('delivered');
  document.getElementById('target').textContent=TARGET;

  /* --- Rest of JS stays identical to the last version I sent --- */
  /* You can paste in the rest of the script from the previous working build */

</script>
</body>
</html>